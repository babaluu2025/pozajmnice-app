<!DOCTYPE html>
<html lang="hr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pozajmnice</title>
    <link rel="icon" type="image/x-icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>ü§ù</text></svg>">
    <style>
        * { box-sizing: border-box; margin: 0; padding: 0; }
        body { font-family: 'Segoe UI', sans-serif; background: #f5f5f5; }
        .container { max-width: 1200px; margin: 0 auto; padding: 20px; }
        
        .login-container { 
            display: flex; 
            justify-content: center; 
            align-items: center; 
            height: 100vh; 
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        .login-box { 
            background: white; 
            padding: 40px; 
            border-radius: 10px; 
            box-shadow: 0 10px 30px rgba(0,0,0,0.2); 
            text-align: center; 
            width: 90%; 
            max-width: 400px; 
        }
        .login-icon { font-size: 4rem; margin-bottom: 20px; }
        .login-title { color: #333; margin-bottom: 10px; }
        .password-input { margin: 20px 0; }
        .password-input input { 
            width: 100%; 
            padding: 12px; 
            border: 2px solid #ddd; 
            border-radius: 5px; 
            font-size: 16px; 
        }
        .login-btn { 
            background: #667eea; 
            color: white; 
            border: none; 
            padding: 12px 30px; 
            border-radius: 5px; 
            font-size: 16px; 
            cursor: pointer; 
            width: 100%; 
        }
        .error-message { color: red; margin-top: 10px; display: none; }
        
        header { background: white; padding: 15px 0; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        .header-content { display: flex; justify-content: space-between; align-items: center; }
        .btn { padding: 8px 15px; border: none; border-radius: 5px; cursor: pointer; margin-left: 10px; }
        .btn-success { background: #28a745; color: white; }
        .btn-info { background: #17a2b8; color: white; }
        .btn-danger { background: #dc3545; color: white; }
        .btn-warning { background: #ffc107; color: black; }
        
        .main-tabs { display: flex; margin: 20px 0; border-bottom: 2px solid #ddd; }
        .main-tab { 
            padding: 12px 24px; 
            background: none; 
            border: none; 
            cursor: pointer; 
            border-bottom: 3px solid transparent; 
        }
        .main-tab.active { border-bottom-color: #667eea; color: #667eea; font-weight: bold; }
        
        .content-section { display: none; }
        .content-section.active { display: block; }
        
        .sync-status { 
            padding: 10px; 
            margin: 10px 0; 
            border-radius: 5px; 
            display: none; 
        }
        .sync-success { background: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
        .sync-error { background: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }
        .sync-warning { background: #fff3cd; color: #856404; border: 1px solid #ffeaa7; }
        
        .form-group { margin-bottom: 15px; }
        .form-group label { display: block; margin-bottom: 5px; font-weight: bold; }
        .form-group input, .form-group select, .form-group textarea { 
            width: 100%; 
            padding: 8px; 
            border: 1px solid #ddd; 
            border-radius: 4px; 
        }
        table { width: 100%; border-collapse: collapse; background: white; margin-top: 10px; }
        th, td { padding: 12px; text-align: left; border-bottom: 1px solid #ddd; }
        th { background: #f8f9fa; font-weight: bold; }
        
        .loading { opacity: 0.7; pointer-events: none; position: relative; }
        .loading::after { 
            content: "‚è≥"; 
            position: absolute; 
            right: 10px; 
            top: 50%; 
            transform: translateY(-50%); 
        }

        .config-panel {
            background: white;
            padding: 20px;
            border-radius: 8px;
            margin: 20px 0;
            border: 2px solid #667eea;
        }
    </style>
</head>
<body>
    <div id="loginScreen" class="login-container">
        <div class="login-box">
            <div class="login-icon">ü§ù</div>
            <h1 class="login-title">Pozajmnice</h1>
            <p>Unesite ≈°ifru za pristup aplikaciji</p>
            <div class="form-group password-input">
                <input type="password" id="passwordInput" placeholder="≈†ifra" autocomplete="off" value="123">
            </div>
            <button id="loginBtn" class="login-btn">Pristupi</button>
            <div id="errorMessage" class="error-message">Pogre≈°na ≈°ifra!</div>
            <div style="margin-top: 15px; color: #666; font-size: 0.9rem;">
                <strong>≈†ifra za test: 123</strong>
            </div>
        </div>
    </div>
    
    <div id="appContent" style="display: none;">
        <header>
            <div class="container">
                <div class="header-content">
                    <h1>ü§ù Pozajmnice</h1>
                    <div>
                        <button id="syncBtn" class="btn btn-info">üîÑ Uƒçitaj iz Sheets</button>
                        <button id="saveBtn" class="btn btn-success">üíæ Spremi u Sheets</button>
                        <button id="configBtn" class="btn btn-warning">‚öôÔ∏è Pode≈°avanje</button>
                        <button id="logoutBtn" class="btn btn-danger">Odjava</button>
                    </div>
                </div>
            </div>
        </header>

        <div class="container">
            <div id="syncStatus" class="sync-status"></div>
            
            <!-- Configuration Panel -->
            <div id="configPanel" class="config-panel" style="display: none;">
                <h3>‚öôÔ∏è Pode≈°avanje Google Sheets</h3>
                
                <div class="form-group">
                    <label>Google Sheets ID:</label>
                    <input type="text" id="sheetIdInput" placeholder="1TdAZal8V82wnjhiGIoJqNzZEzWapVQL-W3WdiqJYYQo" style="font-family: monospace;">
                    <small>ID iz URL-a va≈°eg Sheet-a: docs.google.com/spreadsheets/d/<strong>OVDJE_ID</strong>/edit</small>
                </div>
                
                <div style="display: flex; gap: 10px; margin-top: 15px;">
                    <button id="testConnection" class="btn btn-info">Testiraj konekciju</button>
                    <button id="saveConfig" class="btn btn-success">Spremi pode≈°avanja</button>
                    <button id="closeConfig" class="btn btn-danger">Zatvori</button>
                </div>
                
                <div id="configStatus" style="margin-top: 15px;"></div>
            </div>
            
            <div class="main-tabs">
                <button class="main-tab active" data-section="objekti">Objekti</button>
                <button class="main-tab" data-section="transactions">Sve Transakcije</button>
                <button class="main-tab" data-section="items">Artikli</button>
            </div>
            
            <div id="objekti" class="content-section active">
                <div style="background: white; padding: 20px; border-radius: 8px; margin-bottom: 20px;">
                    <h3>Dodaj novi objekat</h3>
                    <form id="objekatForm">
                        <div class="form-group">
                            <label>Naziv objekta:</label>
                            <input type="text" id="objekatName" required>
                        </div>
                        <div class="form-group">
                            <label>Kontakt:</label>
                            <input type="text" id="objekatContact">
                        </div>
                        <div class="form-group">
                            <label>Napomena:</label>
                            <textarea id="objekatNote" rows="2"></textarea>
                        </div>
                        <button type="submit" class="btn btn-success">Dodaj objekat</button>
                    </form>
                </div>

                <div style="background: white; padding: 20px; border-radius: 8px;">
                    <h3>Lista objekata</h3>
                    <table id="objektiTable">
                        <thead>
                            <tr>
                                <th>Naziv</th>
                                <th>Kontakt</th>
                                <th>Napomena</th>
                                <th>Akcije</th>
                            </tr>
                        </thead>
                        <tbody></tbody>
                    </table>
                </div>
            </div>
            
            <div id="items" class="content-section">
                <div style="background: white; padding: 20px; border-radius: 8px; margin-bottom: 20px;">
                    <h3>Dodaj novi artikal</h3>
                    <form id="itemForm">
                        <input type="hidden" id="editingItemId" value="">
                        <div class="form-group">
                            <label>Naziv artikla:</label>
                            <input type="text" id="itemName" required>
                        </div>
                        <div class="form-group">
                            <label>Jedinica mjere:</label>
                            <input type="text" id="itemUnit" placeholder="npr. komad, kg, litra..." required>
                        </div>
                        <button type="submit" class="btn btn-success">Dodaj artikal</button>
                        <button type="button" id="cancelEdit" class="btn btn-danger" style="display: none;">Otka≈æi</button>
                    </form>
                </div>

                <div style="background: white; padding: 20px; border-radius: 8px;">
                    <h3>Lista artikala</h3>
                    <table id="itemsTable">
                        <thead>
                            <tr>
                                <th>Naziv</th>
                                <th>Jedinica</th>
                                <th>Akcije</th>
                            </tr>
                        </thead>
                        <tbody></tbody>
                    </table>
                </div>
            </div>
            
            <div id="transactions" class="content-section">
                <div style="background: white; padding: 20px; border-radius: 8px;">
                    <h3>Sve transakcije</h3>
                    <table id="allTransactionsTable">
                        <thead>
                            <tr>
                                <th>Datum</th>
                                <th>Objekat</th>
                                <th>Artikal</th>
                                <th>Tip</th>
                                <th>Koliƒçina</th>
                                <th>Napomena</th>
                            </tr>
                        </thead>
                        <tbody></tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <script>
        // ‚úÖ KONFIGURACIJA
        const APP_PASSWORD = "123";
        
        // Globalne varijable
        let currentObjekatId = null;
        let objekti = [];
        let items = [];
        let transactions = [];
        let SHEET_ID = "";

        // ‚úÖ KONFIGURACIJA SHEET-A
        function loadConfig() {
            SHEET_ID = localStorage.getItem('sheetId') || '1TdAZal8V82wnjhiGIoJqNzZEzWapVQL-W3WdiqJYYQo';
            document.getElementById('sheetIdInput').value = SHEET_ID;
        }

        function saveConfig() {
            SHEET_ID = document.getElementById('sheetIdInput').value.trim();
            if (!SHEET_ID) {
                showConfigStatus('‚ùå Unesite Sheet ID!', 'error');
                return;
            }
            
            localStorage.setItem('sheetId', SHEET_ID);
            showConfigStatus('‚úÖ Pode≈°avanja spremljena!', 'success');
        }

        async function testConnection() {
            const sheetId = document.getElementById('sheetIdInput').value.trim();
            if (!sheetId) {
                showConfigStatus('‚ùå Unesite Sheet ID!', 'error');
                return;
            }

            showConfigStatus('üîç Testiram konekciju...', 'info');
            
            try {
                // Testiramo uƒçitavanje objekata
                const testUrl = `https://docs.google.com/spreadsheets/d/${sheetId}/gviz/tq?tqx=out:csv&sheet=Objekti`;
                const response = await fetch(testUrl);
                
                if (response.ok) {
                    showConfigStatus('‚úÖ Konekcija uspje≈°na! Sheet je dostupan.', 'success');
                } else {
                    throw new Error('Sheet nije pronaƒëen');
                }
            } catch (error) {
                showConfigStatus('‚ùå Gre≈°ka: ' + error.message, 'error');
            }
        }

        function showConfigStatus(message, type) {
            const statusEl = document.getElementById('configStatus');
            statusEl.textContent = message;
            statusEl.style.color = type === 'error' ? '#dc3545' : type === 'success' ? '#28a745' : '#17a2b8';
            statusEl.style.fontWeight = 'bold';
        }

        // ‚úÖ GOOGLE SHEETS INTEGRACIJA
        async function saveToSheets() {
            if (!SHEET_ID) {
                showSyncStatus('‚ùå Nije postavljen Sheet ID. Idite u Pode≈°avanje.', 'error');
                return false;
            }

            showSyncStatus('üíæ Spremanje u Google Sheets...', 'info');
            
            try {
                // Kreiraj CSV podatke
                const objektiCSV = convertToCSV(objekti, ['id', 'name', 'contact', 'note', 'createdAt']);
                const itemsCSV = convertToCSV(items, ['id', 'name', 'unit']);
                const transactionsCSV = convertToCSV(transactions, ['id', 'objekatId', 'itemId', 'type', 'quantity', 'date', 'note', 'createdAt']);

                // Prika≈æi podatke za kopiranje
                showDataForManualSave(objektiCSV, itemsCSV, transactionsCSV);
                
                return true;
                
            } catch (error) {
                console.error('Gre≈°ka pri spremanju:', error);
                showSyncStatus('‚ùå Gre≈°ka pri spremanju', 'error');
                return false;
            }
        }

        function convertToCSV(data, headers) {
            if (!data.length) return '';
            
            let csv = headers.join(',') + '\n';
            
            data.forEach(item => {
                const row = headers.map(header => {
                    let value = item[header] || '';
                    // Escape specijalne karaktere
                    value = String(value).replace(/"/g, '""');
                    if (String(value).includes(',') || String(value).includes('"') || String(value).includes('\n')) {
                        value = `"${value}"`;
                    }
                    return value;
                });
                csv += row.join(',') + '\n';
            });
            
            return csv;
        }

        function showDataForManualSave(objektiCSV, itemsCSV, transactionsCSV) {
            const modal = document.createElement('div');
            modal.style.cssText = `
                position: fixed; top: 0; left: 0; width: 100%; height: 100%; 
                background: rgba(0,0,0,0.8); display: flex; justify-content: center; 
                align-items: center; z-index: 1000;
            `;
            
            modal.innerHTML = `
                <div style="background: white; padding: 30px; border-radius: 10px; max-width: 90%; max-height: 90%; overflow: auto; width: 800px;">
                    <h2 style="margin-bottom: 20px;">üìã Podaci za Google Sheets</h2>
                    
                    <div style="margin-bottom: 20px;">
                        <h3>üìÑ Objekti</h3>
                        <textarea id="objektiData" style="width: 100%; height: 150px; font-family: monospace; padding: 10px;" readonly>${objektiCSV}</textarea>
                        <button onclick="copyToClipboard('objektiData')" class="btn btn-info" style="margin-top: 5px;">üìã Kopiraj Objekte</button>
                    </div>
                    
                    <div style="margin-bottom: 20px;">
                        <h3>üì¶ Artikli</h3>
                        <textarea id="itemsData" style="width: 100%; height: 150px; font-family: monospace; padding: 10px;" readonly>${itemsCSV}</textarea>
                        <button onclick="copyToClipboard('itemsData')" class="btn btn-info" style="margin-top: 5px;">üìã Kopiraj Artikle</button>
                    </div>
                    
                    <div style="margin-bottom: 20px;">
                        <h3>üí∞ Transakcije</h3>
                        <textarea id="transactionsData" style="width: 100%; height: 150px; font-family: monospace; padding: 10px;" readonly>${transactionsCSV}</textarea>
                        <button onclick="copyToClipboard('transactionsData')" class="btn btn-info" style="margin-top: 5px;">üìã Kopiraj Transakcije</button>
                    </div>
                    
                    <div style="background: #e7f3ff; padding: 15px; border-radius: 5px; margin-bottom: 15px;">
                        <strong>üìù Upute:</strong><br>
                        1. Idite u va≈° <a href="https://docs.google.com/spreadsheets/d/${SHEET_ID}/edit" target="_blank">Google Sheet</a><br>
                        2. Za svaki sheet (Objekti, Artikli, Transakcije):<br>
                        &nbsp;&nbsp;- Obri≈°ite sve postojeƒáe podatke<br>
                        &nbsp;&nbsp;- Zalijepite odgovarajuƒáe CSV podatke<br>
                        &nbsp;&nbsp;- Odaberite "Text to Columns" sa separatorom zarez
                    </div>
                    
                    <button onclick="this.closest('div').parentElement.remove()" class="btn btn-danger">Zatvori</button>
                </div>
            `;
            
            document.body.appendChild(modal);
            showSyncStatus('‚úÖ Podaci pripremljeni za kopiranje!', 'success');
        }

        // Funkcija za kopiranje u clipboard
        window.copyToClipboard = function(elementId) {
            const textarea = document.getElementById(elementId);
            textarea.select();
            document.execCommand('copy');
            showSyncStatus('üìã Podaci kopirani!', 'success');
        };

        async function loadFromGoogleSheets() {
            if (!SHEET_ID) {
                showSyncStatus('‚ÑπÔ∏è Nema Sheet ID. Koristim lokalne podatke.', 'warning');
                loadFromLocalStorage();
                return false;
            }

            showSyncStatus('üîÑ Uƒçitavam iz Google Sheets...', 'info');
            
            try {
                const [objektiData, itemsData, transactionsData] = await Promise.all([
                    fetchSheetData('Objekti'),
                    fetchSheetData('Artikli'),
                    fetchSheetData('Transakcije')
                ]);

                objekti = parseCSVData(objektiData, ['id', 'name', 'contact', 'note', 'createdAt']);
                items = parseCSVData(itemsData, ['id', 'name', 'unit']);
                transactions = parseCSVData(transactionsData, ['id', 'objekatId', 'itemId', 'type', 'quantity', 'date', 'note', 'createdAt']);

                saveToLocalStorage();
                showSyncStatus('‚úÖ Podaci uspje≈°no uƒçitani!', 'success');
                return true;

            } catch (error) {
                console.log('Uƒçitavam lokalne podatke...', error);
                loadFromLocalStorage();
                showSyncStatus('‚ÑπÔ∏è Koristim lokalne podatke', 'warning');
                return false;
            }
        }

        async function fetchSheetData(sheetName) {
            const url = `https://docs.google.com/spreadsheets/d/${SHEET_ID}/gviz/tq?tqx=out:csv&sheet=${encodeURIComponent(sheetName)}`;
            const response = await fetch(url);
            
            if (!response.ok) {
                throw new Error(`Sheet ${sheetName} nije pronaƒëen`);
            }
            
            return await response.text();
        }

        function parseCSVData(csvText, headers) {
            if (!csvText.trim()) return [];
            
            const lines = csvText.trim().split('\n');
            const result = [];
            
            // Preskoƒçi header red ako postoji
            const startIndex = lines[0].includes(headers[0]) ? 1 : 0;
            
            for (let i = startIndex; i < lines.length; i++) {
                const values = parseCSVLine(lines[i]);
                if (values.length >= headers.length) {
                    const obj = {};
                    headers.forEach((header, index) => {
                        let value = values[index] || '';
                        value = value.replace(/^"|"$/g, '').trim();
                        
                        if (header === 'quantity') {
                            obj[header] = parseFloat(value) || 0;
                        } else {
                            obj[header] = value;
                        }
                    });
                    result.push(obj);
                }
            }
            
            return result;
        }

        function parseCSVLine(line) {
            const result = [];
            let current = '';
            let inQuotes = false;
            
            for (let i = 0; i < line.length; i++) {
                const char = line[i];
                
                if (char === '"') {
                    inQuotes = !inQuotes;
                } else if (char === ',' && !inQuotes) {
                    result.push(current);
                    current = '';
                } else {
                    current += char;
                }
            }
            
            result.push(current);
            return result;
        }

        // ‚úÖ LOKALNO SPREMANJE
        function saveToLocalStorage() {
            localStorage.setItem('objekti', JSON.stringify(objekti));
            localStorage.setItem('items', JSON.stringify(items));
            localStorage.setItem('transactions', JSON.stringify(transactions));
        }

        function loadFromLocalStorage() {
            objekti = JSON.parse(localStorage.getItem('objekti')) || [];
            items = JSON.parse(localStorage.getItem('items')) || [];
            transactions = JSON.parse(localStorage.getItem('transactions')) || [];
        }

        function showSyncStatus(message, type = 'info') {
            const statusEl = document.getElementById('syncStatus');
            statusEl.textContent = message;
            statusEl.className = `sync-status ${type === 'error' ? 'sync-error' : type === 'warning' ? 'sync-warning' : 'sync-success'}`;
            statusEl.style.display = 'block';
            
            setTimeout(() => {
                statusEl.style.display = 'none';
            }, 5000);
        }

        // ‚úÖ EVENT LISTENERI
        document.getElementById('loginBtn').addEventListener('click', login);
        document.getElementById('passwordInput').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') login();
        });
        
        document.getElementById('logoutBtn').addEventListener('click', function() {
            document.getElementById('appContent').style.display = 'none';
            document.getElementById('loginScreen').style.display = 'flex';
        });
        
        document.getElementById('syncBtn').addEventListener('click', async function() {
            this.classList.add('loading');
            await loadFromGoogleSheets();
            refreshAllData();
            this.classList.remove('loading');
        });
        
        document.getElementById('saveBtn').addEventListener('click', async function() {
            this.classList.add('loading');
            await saveToSheets();
            this.classList.remove('loading');
        });
        
        document.getElementById('configBtn').addEventListener('click', function() {
            const panel = document.getElementById('configPanel');
            panel.style.display = panel.style.display === 'none' ? 'block' : 'none';
        });
        
        document.getElementById('saveConfig').addEventListener('click', saveConfig);
        document.getElementById('testConnection').addEventListener('click', testConnection);
        document.getElementById('closeConfig').addEventListener('click', function() {
            document.getElementById('configPanel').style.display = 'none';
        });
        
        async function login() {
            const password = document.getElementById('passwordInput').value;
            if (password === APP_PASSWORD) {
                document.getElementById('loginScreen').style.display = 'none';
                document.getElementById('appContent').style.display = 'block';
                await initApp();
            } else {
                document.getElementById('errorMessage').style.display = 'block';
            }
        }
        
        // ‚úÖ INICIJALIZACIJA
        async function initApp() {
            loadConfig();
            setupEventListeners();
            await loadFromGoogleSheets();
            refreshAllData();
        }
        
        function refreshAllData() {
            loadObjekti();
            loadItems();
            loadAllTransactions();
        }

        function setupEventListeners() {
            document.querySelectorAll('.main-tab').forEach(tab => {
                tab.addEventListener('click', function() {
                    document.querySelectorAll('.main-tab').forEach(t => t.classList.remove('active'));
                    document.querySelectorAll('.content-section').forEach(s => s.classList.remove('active'));
                    
                    this.classList.add('active');
                    document.getElementById(this.dataset.section).classList.add('active');
                });
            });
            
            document.getElementById('objekatForm').addEventListener('submit', async function(e) {
                e.preventDefault();
                await addObjekat(e);
            });
            
            document.getElementById('itemForm').addEventListener('submit', async function(e) {
                e.preventDefault();
                await handleItemForm(e);
            });
            
            document.getElementById('cancelEdit').addEventListener('click', cancelItemEdit);
        }
        
        // ‚úÖ OSTALE FUNKCIJE
        function loadObjekti() {
            const tbody = document.querySelector('#objektiTable tbody');
            tbody.innerHTML = '';
            
            objekti.forEach(objekat => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${objekat.name}</td>
                    <td>${objekat.contact}</td>
                    <td>${objekat.note}</td>
                    <td>
                        <button onclick="showObjekatDetail('${objekat.id}')" class="btn btn-info">Detalji</button>
                        <button onclick="deleteObjekat('${objekat.id}')" class="btn btn-danger">Obri≈°i</button>
                    </td>
                `;
                tbody.appendChild(row);
            });
        }
        
        function loadItems() {
            const tbody = document.querySelector('#itemsTable tbody');
            tbody.innerHTML = '';
            
            items.forEach(item => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${item.name}</td>
                    <td>${item.unit}</td>
                    <td>
                        <button onclick="editItem('${item.id}')" class="btn btn-info">Uredi</button>
                        <button onclick="deleteItem('${item.id}')" class="btn btn-danger">Obri≈°i</button>
                    </td>
                `;
                tbody.appendChild(row);
            });
        }
        
        function loadAllTransactions() {
            const tbody = document.querySelector('#allTransactionsTable tbody');
            tbody.innerHTML = '';
            
            transactions.forEach(trans => {
                const objekat = objekti.find(o => o.id === trans.objekatId) || {name: 'Nepoznato'};
                const item = items.find(i => i.id === trans.itemId) || {name: 'Nepoznato'};
                
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${trans.date}</td>
                    <td>${objekat.name}</td>
                    <td>${item.name}</td>
                    <td>${trans.type === 'pozajmica' ? 'üì§ Pozajmica' : 'üì• Vraƒáeno'}</td>
                    <td>${trans.quantity} ${item.unit}</td>
                    <td>${trans.note}</td>
                `;
                tbody.appendChild(row);
            });
        }
        
        function generateId() {
            return Date.now().toString(36) + Math.random().toString(36).substr(2);
        }
        
        async function addObjekat(e) {
            e.preventDefault();
            
            const objekat = {
                id: generateId(),
                name: document.getElementById('objekatName').value,
                contact: document.getElementById('objekatContact').value,
                note: document.getElementById('objekatNote').value,
                createdAt: new Date().toISOString()
            };
            
            objekti.push(objekat);
            saveToLocalStorage();
            loadObjekti();
            document.getElementById('objekatForm').reset();
            showSyncStatus('Objekat dodan!', 'success');
        }
        
        async function handleItemForm(e) {
            e.preventDefault();
            
            const editingId = document.getElementById('editingItemId').value;
            
            if (editingId) {
                const itemIndex = items.findIndex(item => item.id === editingId);
                if (itemIndex !== -1) {
                    items[itemIndex] = {
                        ...items[itemIndex],
                        name: document.getElementById('itemName').value,
                        unit: document.getElementById('itemUnit').value
                    };
                    saveToLocalStorage();
                    loadItems();
                    cancelItemEdit();
                    showSyncStatus('Artikal a≈æuriran!', 'success');
                }
            } else {
                const item = {
                    id: generateId(),
                    name: document.getElementById('itemName').value,
                    unit: document.getElementById('itemUnit').value
                };
                
                items.push(item);
                saveToLocalStorage();
                loadItems();
                document.getElementById('itemForm').reset();
                showSyncStatus('Artikal dodan!', 'success');
            }
        }
        
        function editItem(itemId) {
            const item = items.find(i => i.id === itemId);
            if (item) {
                document.getElementById('editingItemId').value = item.id;
                document.getElementById('itemName').value = item.name;
                document.getElementById('itemUnit').value = item.unit;
                document.getElementById('cancelEdit').style.display = 'inline-block';
            }
        }
        
        function cancelItemEdit() {
            document.getElementById('editingItemId').value = '';
            document.getElementById('itemForm').reset();
            document.getElementById('cancelEdit').style.display = 'none';
        }
        
        async function deleteObjekat(objekatId) {
            if (confirm('Da li ste sigurni da ≈æelite obrisati ovaj objekat?')) {
                objekti = objekti.filter(o => o.id !== objekatId);
                transactions = transactions.filter(t => t.objekatId !== objekatId);
                saveToLocalStorage();
                loadObjekti();
                showSyncStatus('Objekat obrisan!', 'success');
            }
        }
        
        async function deleteItem(itemId) {
            if (confirm('Da li ste sigurni da ≈æelite obrisati ovaj artikal?')) {
                items = items.filter(i => i.id !== itemId);
                transactions = transactions.filter(t => t.itemId !== itemId);
                saveToLocalStorage();
                loadItems();
                showSyncStatus('Artikal obrisan!', 'success');
            }
        }
        
        function showObjekatDetail(objekatId) {
            alert(`Detalji objekta ID: ${objekatId}`);
        }
        
        window.onload = function() {
            document.getElementById('passwordInput').focus();
        };
    </script>
</body>
</html>
